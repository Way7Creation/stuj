import{_ as P,g,p as V,a as l,c as a,b as o,t as m,j as L,v as D,F as T,l as j,m as v,i as te,s as oe,f as se,e as _,h as I,o as ne,r as q,d as F,w as $,k as le,u as S,y as re,n as x,q as U}from"./main-7ad38b0a.js";const ae={name:"SimpleList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["create","edit","delete"],setup(d){const e=g(""),n=V(()=>{if(!e.value)return d.items;const t=e.value.toLowerCase();return d.items.filter(y=>y.name.toLowerCase().includes(t)||y.slug&&y.slug.toLowerCase().includes(t))});return{searchQuery:e,filteredItems:n}}},ie={class:"space-y-4"},de={class:"flex justify-between items-center"},ce={class:"text-xl font-semibold text-white"},me={class:"mb-4"},ue=["placeholder"],ge={key:0,class:"text-center py-8"},ye={key:1,class:"text-center py-8"},be={class:"text-gray-400"},xe={key:2,class:"space-y-2"},pe={class:"text-white font-medium"},fe={key:0,class:"text-gray-400 text-sm"},ve={class:"flex space-x-2"},he=["onClick"],we=["onClick"];function _e(d,e,n,t,y,p){return l(),a("div",ie,[o("div",de,[o("h3",ce,m(n.title),1),o("button",{onClick:e[0]||(e[0]=i=>d.$emit("create")),class:"bg-stuzha-accent hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"}," + Добавить "+m(n.title.toLowerCase()),1)]),o("div",me,[L(o("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.searchQuery=i),type:"text",placeholder:`Поиск ${n.title.toLowerCase()}...`,class:"w-full max-w-md bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:border-stuzha-accent focus:outline-none"},null,8,ue),[[D,t.searchQuery]])]),n.loading?(l(),a("div",ge,e[2]||(e[2]=[o("div",{class:"text-gray-400"},"Загрузка...",-1)]))):t.filteredItems.length===0?(l(),a("div",ye,[o("div",be,m(t.searchQuery?"Ничего не найдено":`Нет ${n.title.toLowerCase()}`),1)])):(l(),a("div",xe,[(l(!0),a(T,null,j(t.filteredItems,i=>(l(),a("div",{key:i.id,class:"bg-gray-800 rounded-lg p-4 flex justify-between items-center hover:bg-gray-700 transition-colors"},[o("div",null,[o("h4",pe,m(i.name),1),i.slug?(l(),a("p",fe,"Slug: "+m(i.slug),1)):v("",!0)]),o("div",ve,[o("button",{onClick:b=>d.$emit("edit",i),class:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors"}," Редактировать ",8,he),o("button",{onClick:b=>d.$emit("delete",i),class:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors"}," Удалить ",8,we)])]))),128))]))])}const ke=P(ae,[["render",_e]]),Ce={name:"SimpleModal",props:{mode:{type:String,required:!0,validator:d=>["create","edit"].includes(d)},entityType:{type:String,required:!0},form:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:["save","close"],setup(d){const e=V(()=>d.entityType.toLowerCase()==="категорию"),n=V(()=>!(!d.form.name||e.value&&!d.form.slug));return te(()=>d.form.name,t=>{e.value&&d.mode==="create"&&(d.form.slug=t.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}),{showSlug:e,isValid:n}}},Se={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Te={class:"bg-gray-800 rounded-lg max-w-md w-full"},je={class:"p-6"},Le={class:"text-xl font-semibold mb-6 text-white"},Me=["placeholder"],ze={key:0},qe={class:"flex justify-end space-x-3 pt-4"},Ve=["disabled"];function De(d,e,n,t,y,p){return l(),a("div",Se,[o("div",Te,[o("div",je,[o("h3",Le,m(n.mode==="create"?`Добавить ${n.entityType}`:`Редактировать ${n.entityType}`),1),o("form",{onSubmit:e[3]||(e[3]=oe(i=>d.$emit("save"),["prevent"])),class:"space-y-4"},[o("div",null,[e[4]||(e[4]=o("label",{class:"block text-sm font-medium mb-1 text-white"},"Название *",-1)),L(o("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>n.form.name=i),type:"text",required:"",class:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:border-stuzha-accent focus:outline-none",placeholder:`Введите название ${n.entityType.toLowerCase()}`},null,8,Me),[[D,n.form.name]])]),t.showSlug?(l(),a("div",ze,[e[5]||(e[5]=o("label",{class:"block text-sm font-medium mb-1 text-white"},"Slug *",-1)),L(o("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>n.form.slug=i),type:"text",required:"",class:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:border-stuzha-accent focus:outline-none",placeholder:"url-slug"},null,512),[[D,n.form.slug]]),e[6]||(e[6]=o("p",{class:"text-gray-400 text-xs mt-1"},"Используется в URL. Только латиница, цифры и дефисы.",-1))])):v("",!0),o("div",qe,[o("button",{type:"button",onClick:e[2]||(e[2]=i=>d.$emit("close")),class:"px-4 py-2 text-gray-400 hover:text-white transition-colors"}," Отмена "),o("button",{type:"submit",disabled:!t.isValid||n.loading,class:"bg-stuzha-accent hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50"},m(n.loading?"Сохранение...":"Сохранить"),9,Ve)])],32)])])])}const Pe=P(Ce,[["render",De]]),Oe={name:"ConfirmModal",props:{itemName:{type:String,required:!0},entityType:{type:String,required:!0},loading:{type:Boolean,default:!1}},emits:["confirm","cancel"]},Ee={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ne={class:"bg-gray-800 rounded-lg max-w-md w-full"},Be={class:"p-6"},Fe={class:"mb-6"},$e={class:"text-gray-300"},Ie={class:"font-semibold text-white"},Ue={key:0,class:"mb-6 p-3 bg-yellow-900/30 border border-yellow-600 rounded-lg"},Ae={class:"flex justify-end space-x-3"},Qe=["disabled"],Re=["disabled"],He={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"};function We(d,e,n,t,y,p){return l(),a("div",Ee,[o("div",Ne,[o("div",Be,[e[7]||(e[7]=se('<div class="flex items-center mb-4"><div class="flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-4"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><div><h3 class="text-lg font-semibold text-white">Подтвердите удаление</h3></div></div>',1)),o("div",Fe,[o("p",$e,[e[2]||(e[2]=_(" Вы действительно хотите удалить ")),o("span",Ie,m(n.itemName),1),e[3]||(e[3]=_("? "))]),e[4]||(e[4]=o("p",{class:"text-gray-400 text-sm mt-2"}," Это действие нельзя отменить. ",-1))]),n.entityType==="product"?(l(),a("div",Ue,e[5]||(e[5]=[o("p",{class:"text-yellow-200 text-sm"},[o("strong",null,"Внимание:"),_(" При удалении товара также будут удалены все связанные изображения и связи с категориями. ")],-1)]))):v("",!0),o("div",Ae,[o("button",{type:"button",onClick:e[0]||(e[0]=i=>d.$emit("cancel")),class:"px-4 py-2 text-gray-400 hover:text-white transition-colors",disabled:n.loading}," Отмена ",8,Qe),o("button",{type:"button",onClick:e[1]||(e[1]=i=>d.$emit("confirm")),disabled:n.loading,class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center"},[n.loading?(l(),a("svg",He,e[6]||(e[6]=[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):v("",!0),_(" "+m(n.loading?"Удаление...":"Удалить"),1)],8,Re)])])])])}const Ge=P(Oe,[["render",We]]),Je={name:"AdminPanel",components:{SimpleList:ke,SimpleModal:Pe,ConfirmModal:Ge},setup(){const d=re(),e=g("products"),n=g(!1),t=g(!1),y=g("create"),p=g("category"),i=g(!1),b=g(null),M=g(""),z=g(""),k=g([]),C=g([]),s=g([]),h=g([]),f=I({id:null,name:"",slug:""}),w=I({current_page:1,per_page:15,total:0}),A=[{key:"products",name:"Товары"},{key:"categories",name:"Категории"},{key:"themes",name:"Темы"},{key:"attributes",name:"Атрибуты"},{key:"quiz",name:"Квиз"},{key:"marketplace",name:"Маркетплейсы"}],Q=V(()=>Math.ceil(w.total/w.per_page)),O=async(r=1)=>{n.value=!0;try{const u={page:r,per_page:w.per_page,search:M.value,theme_id:z.value},c=await x.get("/admin/products",{params:u});k.value=c.data.data||c.data,c.data.current_page&&Object.assign(w,{current_page:c.data.current_page,total:c.data.total,per_page:c.data.per_page})}catch(u){console.error("Ошибка загрузки товаров:",u)}finally{n.value=!1}},E=async()=>{try{const r=await x.get("/admin/categories");C.value=r.data}catch(r){console.error("Ошибка загрузки категорий:",r)}},N=async()=>{try{const r=await x.get("/admin/themes");s.value=r.data}catch(r){console.error("Ошибка загрузки тем:",r)}},B=async()=>{try{const r=await x.get("/admin/attributes");h.value=r.data}catch(r){console.error("Ошибка загрузки атрибутов:",r)}},R=r=>{y.value="create",p.value=r,K(),t.value=!0},H=(r,u)=>{y.value="edit",p.value=u,Object.assign(f,{id:r.id,name:r.name,slug:r.slug||""}),t.value=!0},W=async()=>{var r,u;n.value=!0;try{const c=`/admin/${p.value}s`;switch(y.value==="create"?await x.post(c,f):await x.put(`${c}/${f.id}`,f),t.value=!1,p.value){case"category":E();break;case"theme":N();break;case"attribute":B();break}}catch(c){console.error("Ошибка сохранения:",c),alert(((u=(r=c.response)==null?void 0:r.data)==null?void 0:u.message)||"Ошибка сохранения")}finally{n.value=!1}},G=(r,u)=>{b.value={item:r,type:u},i.value=!0},J=async()=>{var r,u;if(b.value){n.value=!0;try{const{item:c,type:ee}=b.value;switch(ee){case"product":await x.delete(`/admin/products/${c.id}`),O(w.current_page);break;case"category":await x.delete(`/admin/categories/${c.id}`),E();break;case"theme":await x.delete(`/admin/themes/${c.id}`),N();break;case"attribute":await x.delete(`/admin/attributes/${c.id}`),B();break}i.value=!1,b.value=null}catch(c){console.error("Ошибка удаления:",c),alert(((u=(r=c.response)==null?void 0:r.data)==null?void 0:u.message)||"Ошибка удаления")}finally{n.value=!1}}},K=()=>{Object.assign(f,{id:null,name:"",slug:""})},X=()=>{localStorage.removeItem("auth_token"),delete x.defaults.headers.common.Authorization,d.push("/admin/login")},Y=r=>new Intl.NumberFormat("ru-RU").format(r),Z=r=>({category:"категорию",theme:"тему",attribute:"атрибут"})[r]||r;return ne(()=>{O(),E(),N(),B()}),{activeTab:e,loading:n,modalOpen:t,modalMode:y,modalType:p,deleteConfirmOpen:i,itemToDelete:b,productSearch:M,productThemeFilter:z,products:k,categories:C,themes:s,attributes:h,simpleForm:f,productsPagination:w,tabs:A,totalPages:Q,loadProducts:O,openCreateSimple:R,openEditSimple:H,saveSimple:W,confirmDelete:G,deleteItem:J,logout:X,formatPrice:Y,getEntityTypeName:Z}}},Ke={class:"admin-panel min-h-screen bg-gray-900 p-6"},Xe={class:"max-w-7xl mx-auto"},Ye={class:"flex justify-between items-center mb-8"},Ze={class:"mb-8"},et={class:"flex space-x-1 overflow-x-auto"},tt=["onClick"],ot={class:"bg-gray-800/50 rounded-xl p-6 backdrop-blur-sm border border-gray-700"},st={key:0},nt={class:"flex justify-between items-center mb-6"},lt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},rt=["value"],at={key:0,class:"text-center py-8"},it={key:1,class:"text-center py-8"},dt={key:2,class:"space-y-4"},ct={class:"flex items-center space-x-4"},mt=["src","alt"],ut={key:1,class:"w-16 h-16 bg-gray-600 rounded-lg flex items-center justify-center"},gt={class:"text-white font-medium"},yt={class:"text-gray-400 text-sm"},bt={class:"text-gray-500 text-xs"},xt={key:0,class:"mt-1"},pt={class:"flex space-x-2"},ft=["onClick"],vt={key:0,class:"flex justify-center space-x-2 mt-6"},ht=["onClick"],wt={key:4},_t={key:5};function kt(d,e,n,t,y,p){var k,C;const i=q("router-link"),b=q("SimpleList"),M=q("SimpleModal"),z=q("ConfirmModal");return l(),a("div",Ke,[o("div",Xe,[o("div",Ye,[e[15]||(e[15]=o("h1",{class:"text-3xl font-bold text-white"},"Админ панель",-1)),o("button",{onClick:e[0]||(e[0]=(...s)=>t.logout&&t.logout(...s)),class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors"}," Выйти ")]),o("div",Ze,[o("nav",et,[(l(!0),a(T,null,j(t.tabs,s=>(l(),a("button",{key:s.key,onClick:h=>t.activeTab=s.key,class:U(["px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap",t.activeTab===s.key?"bg-red-600 text-white":"text-gray-400 hover:text-white"])},m(s.name),11,tt))),128))])]),o("div",ot,[t.activeTab==="products"?(l(),a("div",st,[o("div",nt,[e[17]||(e[17]=o("h2",{class:"text-2xl font-semibold text-white"},"Управление товарами",-1)),F(i,{to:"/admin/products/create",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"},{default:$(()=>e[16]||(e[16]=[_(" + Создать товар ")])),_:1,__:[16]})]),o("div",lt,[L(o("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.productSearch=s),type:"text",placeholder:"Поиск товаров...",class:"bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none"},null,512),[[D,t.productSearch]]),L(o("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.productThemeFilter=s),class:"bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none"},[e[18]||(e[18]=o("option",{value:""},"Все темы",-1)),(l(!0),a(T,null,j(t.themes,s=>(l(),a("option",{key:s.id,value:s.id},m(s.name),9,rt))),128))],512),[[le,t.productThemeFilter]]),o("button",{onClick:e[3]||(e[3]=s=>t.loadProducts(1)),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors"}," Применить фильтры ")]),t.loading?(l(),a("div",at,e[19]||(e[19]=[o("div",{class:"text-gray-400"},"Загрузка товаров...",-1)]))):t.products.length===0?(l(),a("div",it,[e[21]||(e[21]=o("div",{class:"text-gray-400"},"Товары не найдены",-1)),F(i,{to:"/admin/products/create",class:"inline-block mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors"},{default:$(()=>e[20]||(e[20]=[_(" Создать первый товар ")])),_:1,__:[20]})])):(l(),a("div",dt,[(l(!0),a(T,null,j(t.products,s=>{var h,f;return l(),a("div",{key:s.id,class:"bg-gray-800 rounded-lg p-4 flex items-center justify-between hover:bg-gray-700 transition-colors"},[o("div",ct,[(h=s.gallery_images)!=null&&h[0]?(l(),a("img",{key:0,src:s.gallery_images[0],alt:s.name,class:"w-16 h-16 object-cover rounded-lg"},null,8,mt)):(l(),a("div",ut,e[22]||(e[22]=[o("span",{class:"text-gray-400 text-xs"},"Нет фото",-1)]))),o("div",null,[o("h4",gt,m(s.name),1),o("p",yt,m(t.formatPrice(s.price))+" ₽",1),o("p",bt,"Тема: "+m(((f=s.theme)==null?void 0:f.name)||"Не указана"),1),s.use_matryoshka?(l(),a("div",xt,e[23]||(e[23]=[o("span",{class:"bg-purple-600 text-white px-2 py-1 rounded text-xs"},"Матрёшка",-1)]))):v("",!0)])]),o("div",pt,[F(i,{to:`/admin/products/edit/${s.id}`,class:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors"},{default:$(()=>e[24]||(e[24]=[_(" Редактировать ")])),_:2,__:[24]},1032,["to"]),o("button",{onClick:w=>t.confirmDelete(s,"product"),class:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors"}," Удалить ",8,ft)])])}),128)),t.totalPages>1?(l(),a("div",vt,[(l(!0),a(T,null,j(t.totalPages,s=>(l(),a("button",{key:s,onClick:h=>t.loadProducts(s),class:U(["px-3 py-1 rounded transition-colors",t.productsPagination.current_page===s?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},m(s),11,ht))),128))])):v("",!0)]))])):t.activeTab==="categories"?(l(),S(b,{key:1,title:"Категории",items:t.categories,loading:t.loading,onCreate:e[4]||(e[4]=s=>t.openCreateSimple("category")),onEdit:e[5]||(e[5]=s=>t.openEditSimple(s,"category")),onDelete:e[6]||(e[6]=s=>t.confirmDelete(s,"category"))},null,8,["items","loading"])):t.activeTab==="themes"?(l(),S(b,{key:2,title:"Темы",items:t.themes,loading:t.loading,onCreate:e[7]||(e[7]=s=>t.openCreateSimple("theme")),onEdit:e[8]||(e[8]=s=>t.openEditSimple(s,"theme")),onDelete:e[9]||(e[9]=s=>t.confirmDelete(s,"theme"))},null,8,["items","loading"])):t.activeTab==="attributes"?(l(),S(b,{key:3,title:"Атрибуты",items:t.attributes,loading:t.loading,onCreate:e[10]||(e[10]=s=>t.openCreateSimple("attribute")),onEdit:e[11]||(e[11]=s=>t.openEditSimple(s,"attribute")),onDelete:e[12]||(e[12]=s=>t.confirmDelete(s,"attribute"))},null,8,["items","loading"])):t.activeTab==="quiz"?(l(),a("div",wt,e[25]||(e[25]=[o("h2",{class:"text-2xl font-semibold text-white mb-6"},"Правила астрологического квиза",-1),o("p",{class:"text-gray-400 mb-4"},"Здесь будет управление правилами подбора камней по дате рождения",-1),o("div",{class:"bg-gray-700 rounded-lg p-4"},[o("p",{class:"text-gray-300"},"Функционал в разработке")],-1)]))):t.activeTab==="marketplace"?(l(),a("div",_t,e[26]||(e[26]=[o("h2",{class:"text-2xl font-semibold text-white mb-6"},"Синхронизация с маркетплейсами",-1),o("p",{class:"text-gray-400 mb-4"},"Здесь будет управление синхронизацией с Wildberries, Ozon, Яндекс.Маркет, flowwow",-1),o("div",{class:"bg-gray-700 rounded-lg p-4"},[o("p",{class:"text-gray-300"},"Функционал в разработке")],-1)]))):v("",!0)])]),t.modalOpen?(l(),S(M,{key:0,mode:t.modalMode,"entity-type":t.getEntityTypeName(t.modalType),form:t.simpleForm,loading:t.loading,onSave:t.saveSimple,onClose:e[13]||(e[13]=s=>t.modalOpen=!1)},null,8,["mode","entity-type","form","loading","onSave"])):v("",!0),t.deleteConfirmOpen?(l(),S(z,{key:1,"item-name":((C=(k=t.itemToDelete)==null?void 0:k.item)==null?void 0:C.name)||"элемент",loading:t.loading,onConfirm:t.deleteItem,onCancel:e[14]||(e[14]=s=>t.deleteConfirmOpen=!1)},null,8,["item-name","loading","onConfirm"])):v("",!0)])}const St=P(Je,[["render",kt]]);export{St as default};
